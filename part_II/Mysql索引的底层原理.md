---
layout: default


---

# Mysql索引的底层原理

在Mysql中，索引是用作数据的快速检索，也是优化的主要战场。因此理解索引的底层原理也是非常重要的。笔者有一次面试就没答上来，在这边逼自己再重新学一下。

## Mysql索引的底层数据结构：

1. **哈希表（Hash）**

   把数据通过哈希函数变换为固定长度的key地址，通过这个地址进行储存。在检索时同样通过哈希函数变换，就能很快找到目标地址。

   但是哈希算法有个数据碰撞的问题，不同的key可能会计算成同一个结果，在这样的情况下，一个常见的处理方式就是链地址法，使用链表把碰撞的数据连起来。计算哈希值之后，还需要检查是否存在碰撞数据链表，若存在，则遍历链表，直到找到目标值。

2. **B+树**

   由于二叉查找树在极端情况下会退化成线性链表，检索性能急剧下降，因此需要使用有自旋功能的AVL树和红黑树。红黑树在某些情况下也会发生向某个方向倾斜的情况，而AVL树的自平衡性更强（平衡开销也更多），稳定性更好。

   然而由于数据库查询数据的瓶颈在于磁盘IO，AVL树的每一个树节点只存了一个数据，当树比较深时，磁盘IO的次数会非常多；于是出现了B树。B树的每个节点的数据可以适当的增加，同时减少树的深度，这符合磁盘IO性能低，但是一次能读取的数据多的特性。

   B+树则是对B树的再一次进化。首先，B+树的非叶子结点只存索引，这近一步减少了树的深度。同时，B+树的叶子结点通过一个链表串联起来，更便于范围查找。

   因此，Mysql索引使用的就是B+树，它在查找效率，查找范围中都有着非常不错的性能。

## InnoDB引擎和MyISAM引擎的实现：

### InnoDB引擎

支持了ACID兼容的事务功能，同时支持行级锁。

InnoDB创建表后生成的文件有：

- frm：创建表的语句
- idb：表里面的数据+索引文件

InnoDB引擎使用聚焦索引的方式。首先InnoDB会根据主键ID作为KEY建立B+树，B+树的叶子结点储存的是主键ID对应的数据。

### MyISAM引擎

查找性能极佳，但是不支持事务处理。

- frm：创建表的语句
- MYD：表里面的数据文件
- MYI：表里面的索引文件

MyISAM引擎使用非聚焦索引方式，数据和索引落在两个不同的文件上。MyISAM在建表的时候用主键作为key来建立主索引B+树，树的叶子结点储存对应的物理地址。

[back](../)

